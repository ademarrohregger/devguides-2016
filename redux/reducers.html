<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="stylesheet" href="../assets/style.css"><link rel="prefetch" href="react"><link rel="prerender" href="react"><link rel="next" href="react"><title>Reducers - Redux</title></head><body class="-chapter"><div class="book-nav"><div class="nav-button"></div></div><div class="chapter-nav"><a href=".">Redux</a><span>Reducers</span></div><div id="body"><div class="markdown-body -literate"><div class="page-section"><div class="container"><h5 class="chapter-prelude"><a href="/" class="root">devguides.io</a><span> / </span><a href="." class="book">Redux</a></h5><h1 id="reducers">Reducers</h1>
<p>The function you pass to <code>createStore()</code> is called a reducer. It's a simple function that takes in a state, and returns another state.</p>
<pre><code class="language-js">reducer(state, action) <span class="hljs-result">state</span>
</code></pre>
<hr>
<p>Most reducers use <code>switch</code> inside them to do different things depending on the <code>action</code>.</p>
<pre><code class="language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reducer</span> (<span class="hljs-params">state, action</span>) </span>{
  <span class="hljs-keyword">switch</span> (action.type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'PUBLISH'</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-highlight">{ ...state, published: <span class="hljs-literal">true</span> }</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'UNPUBLISH'</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-highlight">{ ...state, published: <span class="hljs-literal">false</span> }</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'UPDATE'</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-highlight">{ ...state, ...action.data }</span>
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">return</span> state
  }
}
</code></pre>
<blockquote class="up-next">
<p>Why do we keep using <code>...</code>? <a href="#immutability">Next</a></p>
</blockquote>
</div></div><div class="page-section"><div class="container">
<h1 id="immutability">Immutability</h1>
<p>Never modify the state! That's the Redux way of doing things.
This is called <em>immutability</em>, in other words, never having to mutate.</p>
<pre><code class="language-js"><span class="hljs-line -mute"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reducer</span> (<span class="hljs-params">state, action</span>) </span>{ </span><span class="hljs-line -mute">  <span class="hljs-keyword">switch</span> (action.type) { </span><span class="hljs-line -mute">    <span class="hljs-keyword">case</span> <span class="hljs-string">'PUBLISH'</span>: </span>
      state.published = <span class="hljs-literal">true</span>  <span class="hljs-placeholder -warning">Avoid</span><span class="hljs-line -mute">      <span class="hljs-keyword">return</span> state </span>
<span class="hljs-hr"></span>
      <span class="hljs-keyword">return</span> { ...state, published: <span class="hljs-literal">true</span> }  <span class="hljs-placeholder -ok"></span>
</code></pre>
<hr>
<p>This seems like a hassle at first, but it makes your app faster in the long run. You'll be able to check if a state has changed.</p>
<pre><code class="language-js"><span class="hljs-keyword">var</span> orig = { message: <span class="hljs-string">'Hello'</span> }
<span class="hljs-keyword">var</span> copy = orig
orig.message = <span class="hljs-string">'Hola'</span>
orig === copy  <span class="hljs-placeholder -warning">true</span><span class="hljs-hr"></span>
<span class="hljs-placeholder -warning">State mutations break equality checks.</span>
</code></pre>
<p>If your React app seems like it's not updating, it's probably because you're mutating state. It'd make <code>state === oldState</code> even if they changed, making React skip doing updates.</p>
<blockquote class="up-next">
<p>What happens when my reducer gets very big? <a href="#combining-reducers">Next</a></p>
</blockquote>
</div></div><div class="page-section"><div class="container">
<h1 id="combining-reducers">Combining reducers</h1>
<p>Let's say you app has <em>articles</em> and <em>users</em>. If we put everything into one reducer, we'll be writing a very long function! There's a better way. Imagine your store state looks like this:</p>
<pre><code class="language-js">{
  articles: {<span class="hljs-ellipsis"></span>},
  users: {<span class="hljs-ellipsis"></span>}
}
</code></pre>
<hr>
<p>You can use <code>combineReducers</code> to make two reducers, each working on one part.
This is only useful if each reducer works on a single part of your state.</p>
<pre><code class="language-js"><span class="hljs-line -mute"><span class="hljs-keyword">import</span> { combineReducers, createStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span> </span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">articles</span> (<span class="hljs-params">state, action</span>) </span>{
  <span class="hljs-placeholder -ok">...<code>state</code> is <code>state.articles</code> here.</span>
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">users</span> (<span class="hljs-params">state, action</span>) </span>{
  <span class="hljs-placeholder -ok">...<code>state</code> is <code>state.users</code> here.</span>
}<span class="hljs-hr"></span>
<span class="hljs-keyword">let</span> reducer = <span class="hljs-highlight">combineReducers({ articles, users })</span><span class="hljs-line -mute"><span class="hljs-keyword">let</span> store = createStore(reducer) </span>
</code></pre>
<blockquote class="see-also">
<p><span>Also see:</span> <a href="http://redux.js.org/docs/api/combineReducers.html">combineReducers()</a></p>
</blockquote>
<!-- -->
<blockquote class="up-next">
<p>What do you mean &quot;on a single part&quot;? <a href="#state-subtrees">Next</a></p>
</blockquote>
</div></div><div class="page-section"><div class="container">
<h1 id="state-subtrees">State subtrees</h1>
<p>Think of your state as a tree. It has branches which have their own branches and leaves, and so on. A subtree is one branch of that tree.</p>
<pre><code class="language-js"><span class="hljs-line -mute">state = { </span>
  profile: {
    name: <span class="hljs-string">'John Jones'</span>,
    private: <span class="hljs-literal">true</span>
  },<span class="hljs-line -mute">  photos: [ </span><span class="hljs-line -mute">    <span class="hljs-ellipsis"></span> </span><span class="hljs-line -mute">  ] </span><span class="hljs-line -mute">} </span><span class="hljs-hr"></span>
<span class="hljs-placeholder -info"><code>state.profile</code> is a subtree of the <em>state</em> tree.</span>
</code></pre>
<hr>
<p><code>combineReducers()</code> lets you break apart your reducer. Your reducers will only operate in their own subtree, like <em>state.profile</em> above.</p>
<pre><code class="language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">profile</span> (<span class="hljs-params">state, action</span>) </span>{
  <span class="hljs-keyword">if</span> (action.type === <span class="hljs-string">'PUBLISH'</span>) {
    <span class="hljs-placeholder -info-left"><code>state</code> is limited to <code>state.profile</code> here.</span>
    <span class="hljs-keyword">return</span> { ...state, private: <span class="hljs-literal">false</span> }
  }
}<span class="hljs-hr"></span>
<span class="hljs-keyword">let</span> reducer = combineReducers({ <span class="hljs-highlight">profile</span>, <span class="hljs-ellipsis"></span> })
</code></pre>
<p>This reducer can't see <code>state.photos</code>! This is usually a good thing. As your store reducers get bigger, you're assured that they only play in one part of your state tree.</p>
<blockquote class="up-next">
<p>What if my I need my reducers to do more than that? <a href="#reduce-reducers">Next</a></p>
</blockquote>
</div></div><div class="page-section"><div class="container">
<h1 id="reduce-reducers">Reduce reducers</h1>
<p>Another approach to combining reducers is to use <em>reduce-reducers</em>. Unlike <em>combineReducers()</em>, these sub-reducers will be able to work on the entire tree.</p>
<pre><code class="language-js"><span class="hljs-line -mute"><span class="hljs-keyword">import</span> reduceReducers <span class="hljs-keyword">from</span> <span class="hljs-string">'reduce-reducers'</span> </span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">profiles</span> (<span class="hljs-params">state, action</span>) </span>{
  <span class="hljs-placeholder -info-left">See the whole <code>state</code> here.</span>
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">photos</span> (<span class="hljs-params">state, action</span>) </span>{
  <span class="hljs-placeholder -info-left">Here, as well.</span>
}<span class="hljs-hr"></span>
<span class="hljs-keyword">let</span> reducer = <span class="hljs-highlight">reduceReducers(profiles, photos)</span>
<span class="hljs-keyword">let</span> store = createStore(reducer)
</code></pre>
<p>reduce-reducers is a 3rd-party package. It's one of the many plugins available in the Redux ecosystem in npm.</p>
<blockquote class="see-also">
<p><span>Also see:</span> <a href="https://github.com/acdlite/reduce-reducers">reduce-reducers</a></p>
</blockquote>
<!-- -->
<blockquote class="up-next">
<p>Let's recap what we've learned. <a href="#recap">Next</a></p>
</blockquote>
</div></div><div class="page-section"><div class="container">
<h1 id="recap">Recap</h1>
<p><strong>Reducers</strong> are functions that take a state, and return a new state.</p>
<pre><code class="language-js">reducer(state, action) <span class="hljs-result">state</span>
</code></pre>
<hr>
<p><strong>Immutable:</strong> reducers work your state in a way that never mutates objects.</p>
<pre><code class="language-js">state.published = <span class="hljs-literal">true</span>  <span class="hljs-placeholder -warning"></span><span class="hljs-hr"></span>
<span class="hljs-keyword">return</span> { ...state, published: <span class="hljs-literal">true</span> }  <span class="hljs-placeholder -ok"></span>
</code></pre>
<hr>
<p><strong>Composing:</strong> You can use <code>combineReducers()</code> or <code>reduce-reducers</code> to break a big reducer into smaller reducers.</p>
<pre><code class="language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">profile</span> (<span class="hljs-params">state, action</span>) </span>{ <span class="hljs-ellipsis"></span> }
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">photos</span> (<span class="hljs-params">state, action</span>) </span>{ <span class="hljs-ellipsis"></span> }

combineReducers({ profile, photos })
</code></pre>
<blockquote class="up-next">
<p>Let's use Redux with React. <a href="react">Next</a></p>
</blockquote>
</div></div></div></div><script src="../assets/common.min.js"></script><script src="../assets/script.min.js"></script><script>if (window.location.hostname.indexOf('devguides.io') > -1) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga')
  ga('create', 'UA-79044901-1', 'auto')
  ga('send', 'pageview')
}</script></body></html>